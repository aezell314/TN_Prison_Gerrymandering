---
title: "Investigating Prison Gerrymandering in Tennessee"
output: html_notebook
---

```{r}
library(tidygeocoder)
library(tidyverse)
library(sf)
library(leaflet)
```
# Data gathering:

Collecting prison data:
```{r}
# Most prison addresses and capacities came from tn.gov: https://www.tn.gov/correction/state-prisons/state-prison-list.html
# Some prisons did not have their capacity listed on tn.gov. These came from WikiPedia:
#   https://en.wikipedia.org/wiki/Trousdale_Turner_Correctional_Center
#   https://en.wikipedia.org/wiki/South_Central_Correctional_Facility
#   https://en.wikipedia.org/wiki/Whiteville_Correctional_Facility

prison_info <- tibble::tribble(
~name,                  ~address,                    ~capacity,                   ~year_opened,                    ~city,
'Bledsoe County Correctional Complex',          '1045 Horsehead Road, Pikeville, TN 37367-7432',   2265,    2012,  'Pikeville, TN',
'Debra K. Johnson Rehabilitation Center',       '3881 Stewarts Lane, Nashville, TN 37243-0468',    817,      1966, 'Nashville, TN',
'Hardeman County Correctional Facility',         '2520 Union Springs Road, Whiteville, TN 38075-7548',   1976,    1997,  'Nashville, TN',
'Lois M. DeBerry Special Needs Facility',        '7575 Cockrill Bend Boulevard, Nashville, TN 37209-1057',   854,    1992, 'Nashville, TN',
'Mark Luttrell Transition Center',            '6000 State Road, Memphis, TN 38134-7628',     288,   1999,   'Memphis, TN',
'Morgan County Correctional Complex',           '541 Wayne Cotton Morgan Drive, Wartburg, TN 37887-3249',   2128,   1980,   'Wartburg, TN',
'Northeast Correctional Complex',               '5249 Highway 67 West, Mountain City, TN 37683-5000',  1701,    1991,  'Mountain City, TN',
'Northwest Correctional Complex',               '960 State Route 212, Tiptonville, TN 38079-4037', 1776,    1981,   'Tiptonville, TN',
'Riverbend Maximum Security Institution',       '7475 Cockrill Bend Boulevard, Nashville, TN 37243-0471', 786, 1989,  'Nashville, TN',
'South Central Correctional Facility',         '555 Forest Avenue, Clifton, TN 38425-0279', 1676,    	1992,   'Clifton, TN',
'Trousdale Turner Correctional Center',        '140 Macon Way, Hartsville, TN 37074-2080',    2672,  2016,  'Hartsville, TN',
'Turney Center Industrial Complex',             '1499 R.W. Moore Memorial Highway, Only, TN 37140-4050',  1574,   1971,  'Only, TN',
'Whiteville Correctional Facility',            '1440 Union Springs Road, Whiteville, TN 38075-7526',   1536,  2002,  'Whiteville, TN',
'West Tennessee State Penitentiary',           '480 Green Chapel Road, Henning, TN 38041-1150',   980,  1990,  'Henning, TN',
)

# Geocode the prison addresses
prison_info <- prison_info |>
  # First geocode by address
  geocode(address, method = 'osm', lat = latitude , long = longitude) |>
  # Then geocode by prison name
  geocode(name, method = 'osm', lat = latitude_name , long = longitude_name) |>
  # Coalesce latitude and longitude to fill in missing coordinates when searching by address
  mutate(
    latitude = coalesce(latitude, latitude_name),
   longitude = coalesce(longitude, longitude_name)
   ) |>
  # Drop unneeded coordinate columns
  dplyr::select(-latitude_name,-longitude_name)
```

Reading in population data:
```{r}
sldl_pop <- read_csv('../Data/tn_cvap_2023_sldl/tn_cvap_2023_sldl.csv') |>
  dplyr::select(SLDL, CVAP_TOT23, ALL_TOT23) |>
  rename(cvap_total = CVAP_TOT23,
          total_pop = ALL_TOT23) 

head(sldl_pop)
```
```{r}
sldu_pop <- read_csv('../Data/tn_cvap_2023_sldu/tn_cvap_2023_sldu.csv') |>
  dplyr::select(SLDU, CVAP_TOT23, ALL_TOT23) |>
  rename(cvap_total=CVAP_TOT23,
         total_pop = ALL_TOT23)

head(sldu_pop)
```
Reading in district partisan lean data:

```{r}
sldl_partisan <- read_csv('../Data/district-data-sldl/district-data.csv') |>
  select(ID, `E_16-20_COMP_Total`, `E_16-20_COMP_Dem`, `E_16-20_COMP_Rep`) |>
  filter(ID != 0) |>
  rename(SLDL=ID) |>
  mutate(pct_dem = `E_16-20_COMP_Dem`/`E_16-20_COMP_Total`,
         pct_rep = `E_16-20_COMP_Rep`/`E_16-20_COMP_Total`) |>
  select(-starts_with('E_16-20'))
```
```{r}
sldu_partisan <- read_csv('../Data/district-data-sldu/district-data.csv') |>
  select(ID, `E_16-20_COMP_Total`, `E_16-20_COMP_Dem`, `E_16-20_COMP_Rep`) |>
  filter(ID != 0) |>
  rename(SLDU=ID) |>
  mutate(pct_dem = `E_16-20_COMP_Dem`/`E_16-20_COMP_Total`,
         pct_rep = `E_16-20_COMP_Rep`/`E_16-20_COMP_Total`) |>
  select(-starts_with('E_16-20'))
```

Reading in voter registration and demographic data, using census block mapping data to aggregate by district:
```{r}
TN_voter_data <- read_csv('../Data/TN_l2_2024_gen_stats_2020block/TN_l2_2024_gen_stats_2020block.csv') |>
  rename(GEOID20=geoid20,
         voter_turnout=pct_voted_all) |>
  dplyr::select(-starts_with(c('voted', 'pct_voted', 'reg_self_afam')))  # drop specific voter turnout percentages except for overall turnout

# adding census block mapping data for senate districts
TN_voter_data <- full_join(TN_voter_data, read_csv('../Data/block-assignments_statesenate.csv'), by = 'GEOID20') |> 
  rename(SLDU=District) |>
  relocate(SLDU)

# adding census block mapping data for house districts
TN_voter_data <- full_join(TN_voter_data, read_csv('../Data/block-assignments_statehouse.csv'), by = 'GEOID20') |>
   rename(SLDL=District) |>
   relocate(SLDL)
```

```{r}
# aggregating demographic data by house district
sldl_demogr <- TN_voter_data |>
  group_by(SLDL) |>
  summarize(voter_turnout = mean(voter_turnout, na.rm=TRUE), across(reg_all:reg_unk, sum)) |>
  mutate(
    across(
      .cols = reg_gender_male:reg_unk, # for each column that starts with 'reg' (except for reg_all),
      .fns = ~ .x / reg_all * 100,   # divide by reg_all and multiply by 100 to get a percentage
      .names = 'pct_{.col}'   # and update the naming convention for the new columns
    )
  ) |>
  ungroup() |>
  dplyr::select(-starts_with('reg_')) |> # drop the columns that were used in the mutate
  dplyr::select(-starts_with('pct_party_')) # drop voter registration columns since we are using election results instead
  
colnames(sldl_demogr) <- str_replace(colnames(sldl_demogr), 'reg_', '') # remove 'reg' from column names since it's been replaced with 'pct'

# aggregating demographic data by senate district
sldu_demogr <- TN_voter_data |>
  group_by(SLDU) |>
  summarize(voter_turnout = mean(voter_turnout, na.rm=TRUE), across(reg_all:reg_unk, sum)) |>
  mutate(
    across(
      .cols = reg_gender_male:reg_unk, # for each column that starts with 'reg' (except for reg_all),
      .fns = ~ .x / reg_all * 100,   # divide by reg_all and multiply by 100 to get a percentage
      .names = 'pct_{.col}'   # and update the naming convention for the new columns
    )
  ) |>
  ungroup() |>
  dplyr::select(-starts_with('reg_')) |> # drop the columns that were used in the mutate 
  dplyr::select(-starts_with('pct_party_')) # drop voter registration columns since we are using election results instead 
  
colnames(sldu_demogr) <- str_replace(colnames(sldu_demogr), 'reg_', '') # remove 'reg' from column names since it's been replaced with 'pct'
```

Merging in partisan data:
```{r}
sldl_demogr <- full_join(sldl_demogr, sldl_partisan, by = 'SLDL') 
sldl_demogr
```
```{r}
sldu_demogr <- full_join(sldu_demogr, sldu_partisan, by = 'SLDU') 
sldu_demogr
```

Reading in TN state house and senate district boundaries:
```{r}
TN_house_bounds <- st_read('../Data/tn_sldl_adopted_2022/house_districts.shp')
TN_senate_bounds <- st_read('../Data/tn_sldu_adopted_2022/finalsenatedistricts1-17-22.shp')
```
```{r}
TN_senate_bounds |>
  st_drop_geometry()
```

```{r}
# Adding spatial geometry to prison_info tibble
prison_info <- st_as_sf(
  prison_info,
  coords = c('longitude', 'latitude'),
  crs = st_crs(state_house), ## use the same crs as the state house shape file
  remove = FALSE
)
```

Now we will perform a spatial join to determine the district in which each prison is located
```{r}
# Fix issue with duplicate vertices
TN_house_bounds <- sf::st_make_valid(TN_house_bounds)
TN_senate_bounds <- sf::st_make_valid(TN_senate_bounds)

# Spatial join to determine the house/senate district associated with each prison
prisons_sldl <- 
  st_join(TN_house_bounds, prison_info, join = st_contains)

prisons_sldu <- 
  st_join(TN_senate_bounds, prison_info, join = st_contains)
```



Adding prison populations and total populations to the SLDL and SLDU district demographic tibbles:
```{r}
sldu_demogr <- sldu_demogr |>
                full_join((
                  prisons_sldu |> 
                    st_drop_geometry() |> 
                    group_by(DISTRICT) |> 
                    summarize(prison_pop = sum(capacity, na.rm=TRUE)) |>
                    rename(SLDU=DISTRICT)
                  ), 
                  by = 'SLDU') |>
                full_join(sldu_pop, by = 'SLDU')

sldl_demogr <- sldl_demogr |>
                full_join((
                  prisons_sldl |> 
                    st_drop_geometry() |> 
                    group_by(DISTRICT) |> 
                    summarize(prison_pop = sum(capacity, na.rm=TRUE)) |>
                    rename(SLDL=DISTRICT)
                  ), 
                  by = 'SLDL') |>
                full_join(sldl_pop, by = 'SLDL')
```

Adding columns for percent incarcerated and the presence of 1 or more prisons; combining age groups into fewer groups:
```{r}
sldl_demogr <- sldl_demogr |>
  mutate(pct_incarc = prison_pop / cvap_total * 100,
         prisons_present = if_else(prison_pop > 0, TRUE, FALSE),
         pct_under_30 = pct_age_18_19 + pct_age_20_24 + pct_age_25_29,
         pct_30_to_44 = pct_age_30_34 + pct_age_35_44,
         pct_45_to_64 = pct_age_45_54 + pct_age_55_64,
         pct_65_plus = pct_age_65_74 + pct_age_75_84) |>
  dplyr::select(-(starts_with('pct_age'))) |>
  relocate(c(prison_pop, total_pop, cvap_total, pct_incarc, prisons_present), .after = SLDL)

sldu_demogr <- sldu_demogr |>
  mutate(pct_incarc = prison_pop / cvap_total * 100,
         prisons_present = if_else(prison_pop > 0, TRUE, FALSE),
         pct_under_30 = pct_age_18_19 + pct_age_20_24 + pct_age_25_29,
         pct_30_to_44 = pct_age_30_34 + pct_age_35_44,
         pct_45_to_64 = pct_age_45_54 + pct_age_55_64,
         pct_65_plus = pct_age_65_74 + pct_age_75_84) |>
  dplyr::select(-(starts_with('pct_age'))) |>
  relocate(c(prison_pop, total_pop, cvap_total, pct_incarc, prisons_present), .after = SLDU)
```

Now we will redistribute the prison population among districts, weighting by non-inmate population, as a correction for prison malapportionment.

After redistributing the prison population, we will be able to calculate a "vote strength" metric. 

### State house:

```{r}
tot_prison_pop <- sldl_demogr |>
  summarize(sum(prison_pop)) |> pull()
tot_nonprison_pop <- sldl_demogr |>
  summarize(sum(total_pop - prison_pop)) |> pull()

sldl_demogr <- sldl_demogr |>
  mutate(pop_weight = (total_pop - prison_pop)/tot_nonprison_pop,
         # Create new column for adjusted population, which is population plus a weighted portion of the prison population
         pop_adj = total_pop - prison_pop + (pop_weight * tot_prison_pop),
         prison_pop_adj = tot_prison_pop*pop_weight,
         cvap_adj = cvap_total - prison_pop + (pop_weight * tot_prison_pop),
         # Create a new column for vote strength, which is voting population minus prison population divided by adjusted population
         vote_strength = (cvap_total - prison_pop)/cvap_adj) |>
  relocate(pop_adj, cvap_adj, .after = SLDL) |>
  # drop weights since they are not needed
  dplyr::select(-pop_weight)
```



Would any of TN's legislative districts be legally too small or too big if inmates were redistributed?

```{r}
# Creating column for percent population difference from the ideal population (both for actual population and adjusted population)
num_districts <- sldl_demogr |> summarize(n = n_distinct(SLDL)) |> pull()

sldl_demogr <- sldl_demogr |>
  mutate(ideal_pop = sum(sldl_demogr$total_pop) / num_districts,
        pct_pop_dev_adj = ((pop_adj - ideal_pop)/ideal_pop)*100,
         pct_pop_dev = ((total_pop - ideal_pop)/ideal_pop)*100) |>
  relocate(pct_pop_dev_adj, pct_pop_dev, ideal_pop, .after = SLDL) |>
  arrange(desc(pct_pop_dev_adj))

sldl_demogr
```
After redistributing the inmate population among state house districts, two of the districts exceed a 10% deviation from the 'ideal' population. District 68's population is 10.1% larger than the target population, and district 80's population is 10.67% smaller than the target population. 

### State senate:

```{r}
tot_prison_pop <- sldu_demogr |>
  summarize(sum(prison_pop)) |> pull()
tot_nonprison_pop <- sldu_demogr |>
  summarize(sum(total_pop - prison_pop)) |> pull()

sldu_demogr <- sldu_demogr |>
  mutate(pop_weight = (total_pop - prison_pop)/tot_nonprison_pop,
         # Create new column for adjusted population, which is population plus a weighted portion of the prison population
         pop_adj = total_pop - prison_pop + (pop_weight * tot_prison_pop),
         prison_pop_adj = tot_prison_pop*pop_weight,
         cvap_adj = cvap_total - prison_pop + (pop_weight * tot_prison_pop),
         # Create a new column for vote strength, which is voting population minus prison population divided by adjusted population
         vote_strength = (cvap_total - prison_pop)/cvap_adj) |>
  relocate(pop_adj, cvap_adj, .after = SLDU) |>
  # drop weights since they are not needed
  dplyr::select(-pop_weight)
```

```{r}
# Creating column for percent population difference from the ideal population (both for actual population and adjusted population)
num_districts <- sldu_demogr |> summarize(n = n_distinct(SLDU)) |> pull()

sldu_demogr <- sldu_demogr |>
  mutate(ideal_pop = sum(sldu_demogr$total_pop) / num_districts,
        pct_pop_dev_adj = ((pop_adj - ideal_pop)/ideal_pop)*100,
         pct_pop_dev = ((total_pop - ideal_pop)/ideal_pop)*100) |>
  relocate(pct_pop_dev_adj, pct_pop_dev, ideal_pop, .after = SLDU) |>
  arrange(desc(pct_pop_dev_adj))

sldu_demogr
```
After redistributing the inmate population among state senate districts, none of the districts exceed a 10% deviation from the 'ideal' population. 


# Statistical analysis:

### Do prisons significantly increase voting strength?
Summary: The presence of a prison does not have a statistically significant effect on voting strength.

#### For state house districts: 
```{r}
# creating a linear regression model with x = presence of 1 or more prisons, and y = vote strength
lm_prisons_present = lm(vote_strength ~ prisons_present, data = sldl_demogr)
summary(lm_prisons_present)
```

#### For state senate districts:
```{r}
# creating a linear regression model with x = presence of 1 or more prisons, and y = vote strength
sldu_prisons_present = lm(vote_strength ~ prisons_present, data = sldu_demogr)
summary(sldu_prisons_present)
```





### Do districts with prisons differ significantly from districts without prisons?
Summary: No, districts with prisons do not differ from districts without prisons in any statistically significant way. 

#### Partisan makeup:
Do districts with prisons have significantly different partisan makeup than districts without prisons?

##### For state house districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population registered as Democrat
sldl_dem_prisons = lm(pct_dem ~ prisons_present, data = sldl_demogr)
summary(sldl_dem_prisons)
```

##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population registered as Democrat
sldu_dem_prisons = lm(pct_dem ~ prisons_present, data = sldu_demogr)
summary(sldu_dem_prisons)
```

There is not a statistically significant relationship between the presence of a prison and the partisan makeup of the district. 

#### Percent of people under 30:

##### For state house districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is under 30
sldl_under30_prisons = lm(pct_under_30 ~ prisons_present, data = sldl_demogr)
summary(sldl_under30_prisons)
```

##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is under 30
sldu_under30_prisons = lm(pct_under_30 ~ prisons_present, data = sldu_demogr)
summary(sldu_under30_prisons)
```

There is not a statistically significant relationship between the presence of a prison and the percent of the voting age population that is under 30.  

#### Percent of people 65 or older:

##### For state house districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is 65 or older
sldl_65up_prisons = lm(pct_65_plus ~ prisons_present, data = sldl_demogr)
summary(sldl_65up_prisons)
```

##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is 65 or older
sldu_65up_prisons = lm(pct_65_plus ~ prisons_present, data = sldu_demogr)
summary(sldu_65up_prisons)
```
There is not a statistically significant relationship between the presence of a prison and the percent of the voting age population that is over 65.  



#### Race:

##### For state house districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is white
sldl_white_prisons = lm(pct_eur ~ prisons_present, data = sldl_demogr)
summary(sldl_white_prisons)
```

##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is white
sldu_white_prisons = lm(pct_eur ~ prisons_present, data = sldu_demogr)
summary(sldu_white_prisons)
```

There is not a statistically significant relationship between the presence of a prison and the percent of the voting age population that is white.  


#### Political engagement:

##### For state house districts:
We will use voter turnout in the 2024 election as a proxy for political engagement.
```{r}
# creating a linear regression model with x = prisons_present, and y = voter turnout
sldl_turnout_prisons = lm(pct_dem ~ prisons_present, data = sldl_demogr)
summary(sldl_turnout_prisons)
```

##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = voter turnout
sldu_turnout_prisons = lm(pct_dem ~ prisons_present, data = sldu_demogr)
summary(sldu_turnout_prisons)
```
There is not a statistically significant relationship between the presence of a prison and voter turnout. 



#### Gender makeup:
##### For state house districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is male
sldl_male_prisons = lm(pct_gender_male ~ prisons_present, data = sldl_demogr)
summary(sldl_male_prisons)
```
##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is male
sldu_male_prisons = lm(pct_gender_male ~ prisons_present, data = sldu_demogr)
summary(sldu_male_prisons)
```
There is not a statistically significant relationship between the presence of a prison and the gender makeup of the district. 





### After redistributing the prison population, is there a relationship between deviation from the ideal population and demographic makeup/partisan lean?
Summary: Sometimes. 

#### Partisan makeup:
Do districts with a greater population deviation (after redistributing the prison population) have significantly different partisan makeup than districts with lower population deviation?

##### For state house districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population registered as Democrat
sldl_dem_prisons = lm(pct_dem ~ pct_pop_dev_adj, data = sldl_demogr)
summary(sldl_dem_prisons)
```

##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population registered as Democrat
sldu_dem_prisons = lm(pct_dem ~ pct_pop_dev_adj, data = sldu_demogr)
summary(sldu_dem_prisons)
```

There is not a statistically significant relationship between population deviation and the partisan makeup of state house districts.


#### Percent of people under 30:

##### For state house districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is under 30
sldl_under30_prisons = lm(pct_under_30 ~ pct_pop_dev_adj, data = sldl_demogr)
summary(sldl_under30_prisons)
```
For state senate districts, there is a statistically significant relationship between population deviation and the percent of the voting age population that is under 30. For each additional percentage of population deviation, the percentage of the population that is under 30 increases by an average of 0.136%. 

##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is under 30
sldu_under30_prisons = lm(pct_under_30 ~ pct_pop_dev_adj, data = sldu_demogr)
summary(sldu_under30_prisons)
```

For state senate districts, there is not a statistically significant relationship between population deviation and the percent of the voting age population that is under 30.  

#### Percent of people 65 or older:

##### For state house districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is 65 or older
sldl_65up_prisons = lm(pct_65_plus ~ pct_pop_dev_adj, data = sldl_demogr)
summary(sldl_65up_prisons)
```
For state house districts, there is a statistically significant relationship between population deviation and the percent of the voting age population that is over 65. For each additional percent of population deviation, the percent of the population that is 65 or older decreases by about 0.3579%. 

##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is 65 or older
sldu_65up_prisons = lm(pct_65_plus ~ pct_pop_dev_adj, data = sldu_demogr)
summary(sldu_65up_prisons)
```
For state house districts, there is not a statistically significant relationship between population deviation and the percent of the voting age population that is over 65.  



#### Race:

##### For state house districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is white
sldl_white_prisons = lm(pct_eur ~ pct_pop_dev_adj, data = sldl_demogr)
summary(sldl_white_prisons)
```
For state house districts, there is not a statistically significant relationship between population deviation and the percent of the voting age population that is white.  

##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is white
sldu_white_prisons = lm(pct_eur ~ pct_pop_dev_adj, data = sldu_demogr)
summary(sldu_white_prisons)
```

For state senate districts, there is a statistically significant relationship between population deviation and the percent of the voting age population that is white. For each additional percent of population deviation, the percent of the population that is white increases by an average of 2.7%. 


#### Political engagement:

##### For state house districts:
We will use voter turnout in the 2024 election as a proxy for political engagement.
```{r}
# creating a linear regression model with x = prisons_present, and y = voter turnout
sldl_turnout_prisons = lm(pct_party_democratic ~ pct_pop_dev_adj, data = sldl_demogr)
summary(sldl_turnout_prisons)
```
For state house districts, there is not a statistically significant relationship between population deviation and voter turnout. 

##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = voter turnout
sldu_turnout_prisons = lm(pct_party_democratic ~ pct_pop_dev_adj, data = sldu_demogr)
summary(sldu_turnout_prisons)
```
For state senate districts, there is a statistically significant relationship between population deviation and voter turnout. For each additional percent of population deviation, the voter turnout percentage decreases by an average of 1%.



#### Gender makeup:
##### For state house districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is male
sldl_male_prisons = lm(pct_gender_male ~ pct_pop_dev_adj, data = sldl_demogr)
summary(sldl_male_prisons)
```
For state house districts, there is not a statistically significant relationship between population deviation and the gender makeup of the district. 

##### For state senate districts:
```{r}
# creating a linear regression model with x = prisons_present, and y = percent of voting age population that is male
sldu_male_prisons = lm(pct_gender_male ~ pct_pop_dev_adj, data = sldu_demogr)
summary(sldu_male_prisons)
```
For state senate districts, there is a statistically significant relationship between population deviation and the gender makeup of the district. For each additional percent of population deviation, the percentage of the population that is male increases by 0.3198, on average. 




# Preliminary visualizations:
```{r}
# Reading in county boundaries
TN_county_bounds <- st_read('../Data/TN_counties/TN_counties.shp') |> st_transform(crs = st_crs(TN_house_bounds))
```

```{r}
leaflet() |>
addTiles() |> 
addPolygons(
  data = TN_county_bounds,
  color = "blue",
  weight = 1,
  group = "Counties",
  label = ~NAME
) |>
addPolygons(
    data = TN_house_bounds,
    color = "#444444",
    weight = 1,
    fillOpacity = 0.5,
    fillColor = "#fec44f",
    group = "State House Districts",
    highlightOptions = highlightOptions(
      color = "red", weight = 3, bringToFront = TRUE
    ),
    label = ~LONGNAME
  ) |>
  addMarkers(
    data = prisons_sldl,
    lng = ~longitude,
    lat = ~latitude,
    popup = ~as.character(name), 
    label = ~as.character(name)
  ) |>
  # Add layer control to toggle visibility
  addLayersControl(
    overlayGroups = c("Counties", "State House Districts"),
    options = layersControlOptions(collapsed = FALSE)
  )
```


```{r}
leaflet() |>
addTiles() |> 
addPolygons(
    data = TN_senate_bounds,
    color = "#444444",
    weight = 1,
    fillOpacity = 0.5,
    fillColor = "#fec44f",
    highlightOptions = highlightOptions(
      color = "red", weight = 3, bringToFront = TRUE
    ),
    label = ~LONGNAME
  ) |>
  addMarkers(
    data = prisons_sldu,
    lng = ~longitude,
    lat = ~latitude,
    popup = ~as.character(name), 
    label = ~as.character(name)
  )
```


Save data for use in an R Shiny app:
```{r}
saveRDS(prisons_sldu, file = "../Data/prisons_sldu.rds")
saveRDS(prisons_sldl, file = "../Data/prisons_sldl.rds")
saveRDS(sldu_demogr, file = "../Data/sldu_demogr.rds")
saveRDS(sldl_demogr, file = "../Data/sldl_demogr.rds")
saveRDS(TN_house_bounds, file = "../Data/TN_house_bounds.rds")
saveRDS(TN_senate_bounds, file = "../Data/TN_senate_bounds.rds")
saveRDS(prison_info, file = "../Data/prison_info.rds")
```




